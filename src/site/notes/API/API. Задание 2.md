---
{"dg-publish":true,"permalink":"/api/api-zadanie-2/"}
---


## Задание 2. Реализация API посредством strapi

---

**ФИО:** 2022-ФГиИБ-ИБ-1б Максимельянов Илья Максимович

---

ТЗ доступно по ссылке: https://in-homework.vercel.app/

## Ограничение платформы Strapi

>Ограниченные возможности аутентификации: Strapi предлагает ограниченное количество встроенных методов аутентификации, таких как аутентификация через электронную почту или социальные сети. Это может быть недостаточно для некоторых проектов, требующих более сложных методов аутентификации.

## Реализация сущностей
### Сущность Product

Создаём сущность "Товар" с структурой, включающей поля: идентификатор продукта, идентификатор заказа, название, описание, изображение, цена, категория товара, количество.

![createCollection.jpg](/img/user/media/createCollection.jpg)
<center>Создаём сущность Product</center>

По ТЗ заполняем его атрибутами.

![product.png](/img/user/media/product.png)
<center>Заполнение сущности Product атрибутами</center>

Атрибут `img` ограничиваем тем, что в него могут загрузить медиа-файлы только форматов изображения (`.png`, `.jpg` и другие).

![imgValid.jpg](/img/user/media/imgValid.jpg)
<center>Ограничение типов медиа-файлов для атрибута img</center>

Между сущностями Product и Order предполагается связь Многое-ко-многому, то есть, один продукт может находится сразу в нескольких заказах, при этом каждый из заказов принадлежит множеству товаров.

![rel_pro_or.png](/img/user/media/rel_pro_or.png)
<center>Связь между сущностями Product и Order</center>

### Сущность Order

Создадим сущность Order. Структура состоит из таких атрибутов, как: идентификатор заказа, дата, статус заказа, общая цена, связь с сущностью пользователя и связь с сущностью товара.

![order.png](/img/user/media/order.png)
<center>Сущность Order с атрибутами</center>

У сущности также имеется связь с товаром.

![rel_pro_or.png](/img/user/media/rel_pro_or.png)
<center>Связь между сущностями Product и Order</center>

И связь с пользователем.

![rel_us_or.png](/img/user/media/rel_us_or.png)
<center>Связь между сущностями Order и User</center>

### Сущность User

Сущность пользователя уже создана в strapi изначально, но мы добавим ей атрибуты, которых не хватает по ТЗ.
Добавленные атрибуты: имя, фамилия, номер телефона, ID. И один атрибут создался сам, когда мы связали сущность Order с сущностью User.

![user.png](/img/user/media/user.png)
<center>Сущность User с атрибутами</center>

Автоматически созданная связь сущности User и Orders (Один-ко-Многим) подразумевает, что один пользователь может иметь несколько заказов, а заказ может принадлежать только одному пользователю.

![rel_us_or.png](/img/user/media/rel_us_or.png)
<center>Связь User и Oreder (Один-ко-Многим)</center>
## REST-методы

### Сущность User

Использовать REST API запросы, связанные с информацией о пользователях, могут пользователи только с ролью `Administrator`. 

**POST ../api/users**

> Создаёт нового пользователя.

При использовании метода выдаётся информация о созданном пользователе, включая все его атрибуты, которые были указаны в запросе. 
В случае ошибки возвращается соответствующее сообщение.

![PostUser.png](/img/user/media/PostUser.png)
<center>POST запрос</center>

Как мы можем заметить в пользовательском интерфейсе strapi создался пользователь:
![UserStrapi.png](/img/user/media/UserStrapi.png)
<center>Content Manager strapi</center>

**DELETE ../users/{id}**

> Удаляет пользователя с указанным идентификатором.

![DelUser.png](/img/user/media/DelUser.png)
<center>DELETE запрос</center>

**PUT ../users/{id}**

> Обновляет поля атрибутов пользователя, по указанному идентификатору, которые необходимо изменить.

![PutUser.png](/img/user/media/PutUser.png)
<center>PUT запрос</center>
Выводит информацию о пользователе с его атрибутами.

**GET ../users/{id}**

> Возвращает информацию о пользователе по указанному идентификатору.

![GetUser.png](/img/user/media/GetUser.png)
<center>GET запрос</center>
Выводит информацию о пользователе с его атрибутами.

### Сущность Order

Доступ к сущности посредством запросов могут получить лишь пользователи, которые получили роль авторизованного пользователя - `Authenticated`, а пользователи с ролью `Manager` и `Administrator` могут взаимодействовать с сущностью как угодно, если им это потребуется.

REST API запросы для данной сущности выглядят так:

- **POST ../api/orders/**
- **DELETE ../api/orders/{id}**
- **PUT ../api/orders/{id}**
- **GET ../api/orders/{id}**

### Сущность Product

Экземпляры сущности Товара могут быть изменены, удалены или добавлены только пользователями с уровнем привилегий `Manager` и `Administrator`. Обычные пользователи могут лишь просматривать товар.

REST API запросы для данной сущности выглядят так:

- **POST ../api/products/**
- **DELETE ../api/products/{id}**
- **PUT ../api/products/{id}**
- **GET ../api/products/{id}**